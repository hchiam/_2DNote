<head>
  <script src='https://kit.fontawesome.com/a076d05399.js'></script>
  <style>
    body {
      background: #333;
      color: snow;
      width: 100vw;
      height: 100vh;
      font-family: avenir, arial, monospace;
      text-align: center;
    }

    #main {
      background: #5e4f40;
      align-content: center;
      border-radius: 1em;
    }

    #sound-icon {
      color: #335;
      font-size: 10em;
      position: fixed;
      left: calc(50% - 0.5em);
      top: calc(50% - 0.4em);
    }

    footer {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      padding-bottom: 1em;
    }

    a {
      color: snow;
    }

    a:hover {
      color: lime;
    }
  </style>
</head>
<!-- USE _2DNote! -->
<body onclick="playOrStop(event)" 
      onmousemove="instructToClickToStop();_2DNote.update(event,colourSoundIcon);" 
      onmouseleave="exitedView();">
  <div id="main" role="main">
    <h1 id="audio-reminder" aria-hidden="true">Make sure audio is on</h1>
    <p id="instruction" aria-live="polite"></p>
  </div>
  <i id="sound-icon" class='fas fa-music'></i>

  <!-- INCLUDE _2DNote! -->
  <script src="https://cdn.jsdelivr.net/gh/hchiam/_2DNote@latest/_2DNote.js"></script>

  <!-- USE _2DNote! -->
  <script>
    setTimeout(function(){ 
      document.getElementById('instruction').innerHTML = 'Click anywhere to start';
    }, 1000);

    let on = false;

    function playOrStop(e) {
      if (on) {
        on = false;
        _2DNote.stop();
        instructToClickToStart();
      } else {
        on = true;
        hideAudioReminder();
        instructToMoveMouse();
        _2DNote.play(e);
      }
      toggleSoundIcon();
    }

    function exitedView() {
      on = false;
      _2DNote.stop();
      instructToClickToStart();
    }

    function instructToMoveMouse() {
      document.getElementById('instruction').innerHTML = 'Move mouse to play with volume and pitch';
    }

    function hideAudioReminder() {
      document.getElementById('audio-reminder').style.display = 'none';
    }

    function instructToClickToStart() {
      document.getElementById('instruction').innerHTML = 'Click anywhere to start';
    }

    function instructToClickToStop() {
      if (on) {
        document.getElementById('instruction').innerHTML = 'Move mouse to play with volume and pitch <br/><span style="color: lime;">Click anywhere to stop</span>';
      }
    }

    function toggleSoundIcon() {
      if (on) {
        document.getElementById('sound-icon').style.visibility = 'visible';
      } else {
        document.getElementById('sound-icon').style.visibility = 'hidden';
      }
    }

    function colourSoundIcon(volume, frequency) {
      const comfyFrequencyRange = [150, 400];
      const hueRange = [0, 359];
      let hue = _2DNote.normalize(frequency, comfyFrequencyRange, hueRange);
      hue = Math.round(hue);
      const comfyVolumeRange = [0, 0.5];
      const saturationRange = [0, 100];
      let saturation = _2DNote.normalize(volume, comfyVolumeRange, saturationRange);
      saturation = Math.round(saturation);
      const hsl = 'hsl(' + String(hue) + ',' + String(saturation) + '%, 50%)';
      document.getElementById('sound-icon').style.color = hsl;
    }
  </script>
</body>
