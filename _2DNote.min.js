// _2DNote 1.8.0
var _2DNote={audioContext:new AudioContext,note:null,viewXRange:[0,document.documentElement.clientWidth],viewYRange:[0,document.documentElement.clientHeight],comfyFrequencyRange:[150,400],comfyVolumeRange:[0,.5],setAs2DArea:function(e,t){this.callbackUponUpdate=t,document.body.addEventListener("mousedown",this.play.bind(this)),document.body.addEventListener("mouseup",this.stop.bind(this)),document.body.addEventListener("mousemove",this.update.bind(this)),document.body.addEventListener("touchstart",this.play.bind(this)),document.body.addEventListener("touchend",this.stop.bind(this)),document.body.addEventListener("touchmove",this.update.bind(this)),this.setupExitedViewDetection()},play:function(e){this.stop(),this.setupExitedViewDetection();var t=this.getFrequency(e),n=this.getVolume(e),o=this.audioContext.createGain();o.connect(this.audioContext.destination),o.gain.value=n;var i=this.audioContext.createOscillator();i.type="sine",i.frequency.value=t,i.connect(o),i.start(),this.note={oscillator:i,volumeSetup:o}},update:function(e,t){if(this.note){var n=this.getFrequency(e),o=this.getVolume(e);this.note.volumeSetup.gain.value=o,this.note.oscillator.frequency.value=n,t?t(o,n):this.callbackUponUpdate&&this.callbackUponUpdate(o,n)}},stop:function(){null!=this.note&&(this.note.oscillator.stop(this.audioContext.currentTime),this.note=null)},setupExitedViewDetection:function(){document.body.removeEventListener("mouseleave",this.warnExitedView),document.body.removeEventListener("touchcancel",this.warnExitedView),document.body.addEventListener("mouseleave",this.warnExitedView),document.body.addEventListener("touchcancel",this.warnExitedView)},warnExitedView:function(){var e={currentTarget:!0,clientX:document.documentElement.clientWidth/2,clientY:document.documentElement.clientHeight/2};_2DNote.play(e),setTimeout((function(){_2DNote.stop(),document.body.removeEventListener("mouseleave",_2DNote.warnExitedView),document.body.removeEventListener("touchcancel",_2DNote.warnExitedView)}),100)},getFrequency:function(e){var t=this.getX(e);return this.normalize(t,this.viewXRange,this.comfyFrequencyRange)},getVolume:function(e){var t=this.getY(e);return this.normalize(t,this.viewYRange,this.comfyVolumeRange)},getX:function(e){var t=e.currentTarget&&e.clientX,n=e.touches;return t?e.clientX:n?e.touches[0].clientX:e.offsetLeft},getY:function(e){var t=e.currentTarget&&e.clientY,n=e.touches;return t?e.clientY:n?e.touches[0].clientY:e.offsetTop},normalize:function(e,[t,n],[o,i]){return(i-o)/(n-t)*(e-t)+o},copy:function(){return function e(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){var n=[];return t.forEach((function(t){n.push(e(t))})),n}var o={};for(var i in t)t.hasOwnProperty(i)&&("audioContext"===i?o.audioContext=new AudioContext:o[i]=e(t[i]));return o}(this)}};window&&(window._2DNote=_2DNote),module&&(module.exports=_2DNote);
