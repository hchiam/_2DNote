// _2DNote 1.6.0
var _2DNote={audioContext:new AudioContext,note:null,viewXRange:[0,document.documentElement.clientWidth],viewYRange:[0,document.documentElement.clientHeight],comfyFrequencyRange:[150,400],comfyVolumeRange:[0,.5],setAs2DArea:function(e,t){this.callbackUponUpdate=t,document.body.addEventListener("mousedown",this.play.bind(this)),document.body.addEventListener("mouseup",this.stop.bind(this)),document.body.addEventListener("mousemove",this.update.bind(this)),document.body.addEventListener("touchstart",this.play.bind(this)),document.body.addEventListener("touchend",this.stop.bind(this)),document.body.addEventListener("touchmove",this.update.bind(this)),this.setupExitedViewDetection()},play:function(e){this.stop(),this.setupExitedViewDetection();var t=this.getFrequency(e),n=this.getVolume(e),i=this.audioContext.createGain();i.connect(this.audioContext.destination),i.gain.value=n;var o=this.audioContext.createOscillator();o.type="sine",o.frequency.value=t,o.connect(i),o.start(),this.note={oscillator:o,volumeSetup:i}},update:function(e,t){if(this.note){var n=this.getFrequency(e),i=this.getVolume(e);this.note.volumeSetup.gain.value=i,this.note.oscillator.frequency.value=n,t?t(i,n):this.callbackUponUpdate&&this.callbackUponUpdate(i,n)}},stop:function(){null!=this.note&&(this.note.oscillator.stop(this.audioContext.currentTime),this.note=null)},setupExitedViewDetection:function(){document.body.removeEventListener("mouseleave",this.warnExitedView),document.body.removeEventListener("touchcancel",this.warnExitedView),document.body.addEventListener("mouseleave",this.warnExitedView),document.body.addEventListener("touchcancel",this.warnExitedView)},warnExitedView:function(){var e={currentTarget:!0,clientX:document.documentElement.clientWidth/2,clientY:document.documentElement.clientHeight/2};_2DNote.play(e),setTimeout((function(){_2DNote.stop(),document.body.removeEventListener("mouseleave",_2DNote.warnExitedView),document.body.removeEventListener("touchcancel",_2DNote.warnExitedView)}),100)},getFrequency:function(e){var t=this.getX(e);return this.normalize(t,this.viewXRange,this.comfyFrequencyRange)},getVolume:function(e){var t=this.getY(e);return this.normalize(t,this.viewYRange,this.comfyVolumeRange)},getX:function(e){var t=e.currentTarget&&e.clientX,n=e.touches;return t?e.clientX:n?e.touches[0].clientX:e.offsetLeft},getY:function(e){var t=e.currentTarget&&e.clientY,n=e.touches;return t?e.clientY:n?e.touches[0].clientY:e.offsetTop},normalize:function(e,[t,n],[i,o]){return(o-i)/(n-t)*(e-t)+i},copy:function(){return function e(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){var n=[];return t.forEach((function(t){n.push(e(t))})),n}var i={};for(var o in t)t.hasOwnProperty(o)&&("audioContext"===o?i.audioContext=new AudioContext:i[o]=e(t[o]));return i}(this)}};
