// _2DNote 1.8.1
var _2DNote={audioContext:new AudioContext,note:null,viewXRange:[0,document.documentElement.clientWidth],viewYRange:[0,document.documentElement.clientHeight],comfyFrequencyRange:[150,400],comfyVolumeRange:[0,.5],setAs2DArea:function(e,t){this.callbackUponUpdate=t;const n=e||document.body;n.addEventListener("mousedown",this.play.bind(this)),n.addEventListener("mouseup",this.stop.bind(this)),n.addEventListener("mousemove",this.update.bind(this)),n.addEventListener("touchstart",this.play.bind(this)),n.addEventListener("touchend",this.stop.bind(this)),n.addEventListener("touchmove",this.update.bind(this)),this.setupExitedViewDetection(n)},play:function(e){this.stop(),this.setupExitedViewDetection(e);var t=this.getFrequency(e),n=this.getVolume(e),i=this.audioContext.createGain();i.connect(this.audioContext.destination),i.gain.value=isNaN(n)?.5:n;var o=this.audioContext.createOscillator();o.type="sine",o.frequency.value=isNaN(t)?400:t,o.connect(i),o.start(),this.note={oscillator:o,volumeSetup:i}},update:function(e,t){if(this.note){var n=this.getFrequency(e),i=this.getVolume(e);this.note.volumeSetup.gain.value=i,this.note.oscillator.frequency.value=n,t?t(i,n):this.callbackUponUpdate&&this.callbackUponUpdate(i,n)}},stop:function(){null!=this.note&&(this.note.oscillator.stop(this.audioContext.currentTime),this.note=null)},setupExitedViewDetection:function(e){const t=e||document.body;console.log(t),t.removeEventListener&&t.addEventListener&&(t.removeEventListener("mouseleave",this.warnExitedView),t.removeEventListener("touchcancel",this.warnExitedView),t.addEventListener("mouseleave",this.warnExitedView),t.addEventListener("touchcancel",this.warnExitedView))},warnExitedView:function(e){const t=e||document.body;var n={currentTarget:!0,clientX:t.clientWidth/2,clientY:t.clientHeight/2};_2DNote.play(n),setTimeout((function(){_2DNote.stop(),t.removeEventListener&&(t.removeEventListener("mouseleave",_2DNote.warnExitedView),t.removeEventListener("touchcancel",_2DNote.warnExitedView))}),100)},getFrequency:function(e){var t=this.getX(e);return this.normalize(t,this.viewXRange,this.comfyFrequencyRange)},getVolume:function(e){var t=this.getY(e);return this.normalize(t,this.viewYRange,this.comfyVolumeRange)},getX:function(e){var t=e.currentTarget&&e.clientX,n=e.touches;return t?e.clientX:n?e.touches[0].clientX:e.offsetLeft},getY:function(e){var t=e.currentTarget&&e.clientY,n=e.touches;return t?e.clientY:n?e.touches[0].clientY:e.offsetTop},normalize:function(e,[t,n],[i,o]){return(o-i)/(n-t)*(e-t)+i},copy:function(){return function e(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){var n=[];return t.forEach((function(t){n.push(e(t))})),n}var i={};for(var o in t)t.hasOwnProperty(o)&&("audioContext"===o?i.audioContext=new AudioContext:i[o]=e(t[o]));return i}(this)}};window&&(window._2DNote=_2DNote),module&&(module.exports=_2DNote);
